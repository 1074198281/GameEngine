# 基于物理的渲染理论

[TOC]



## 1.立体角

指球面上所包含面积与半径平方的比。对于一个半径为r的球，它的表面上某一块的面积记作A，立体角Ω表示为

Ω = A / r²。

<img src="Image\立体角.png" alt="立体角" style="zoom:50%;" />

### 1.1 单位立体角

指一个**半径为1**的球面上**1平方米面积**所张成的立体角。

![单位立体角推导](Image\单位立体角推导.jpg)

## 2.辐射度量学

常见的辐射量：辐射通量、辐射强度、辐射照度、辐射亮度、

### 2.1 辐射通量（radiance flux）

辐射通量是指单位时间内通过表面或者空间区域的总能量。单位：流明、瓦特。表示为**φ**。辐射通量越大，亮度越大。

### 2.2 辐射强度 （radiant insensity）

辐射强度是点光源发出的**每单位立体角**的辐射通量。单位：坎德拉。表示为  **I(ω) = dφ / dω**。

### 2.3 辐射照度（Irradiance）

辐射照度是表面**每单位照射面积**接受的辐射通量。单位：勒克斯。表示为  **E(x) ≡ dφ(x) / dA**。

辐射照度指的是每单位照射面积接受的通量，当光线垂直入射时面积为A，斜着入射时被照射的面积为**A‘ = A / cosθ** ，面积变大，光束扩大到更大的区域，意味着每单位区域接受的通量越小。

**朗伯余弦定律：光线到达表面的辐射通量与表面法线和入射光方向夹角成比例、**

此外，表面接受的辐射照度还有距离有关，且与距离的平方成反比。说明距离越远，表面接受的辐射通量越少。

### 2.4 辐射亮度（radiance）

辐射亮度指**每单位投影面积**，**每单位立体角**接受的辐射通量。单位：尼特。表示为**L(p,ω) = dφ(p,ω) / dωdAcosθ**。

辐射亮度描述了光在传播过程中的亮度，它不随距离和方向变化。

## 3.微观几何

[reference:https://zhuanlan.zhihu.com/p/633527357]

比波长大得多的表面不规则性会改变表面的局部方向，当这些不规则性小于像素大小时，我们称为 **微观几何(microgeometry)**。它的核心是认为每个微表面都有自己的法向量，它们的分布对整体的法向量有贡献，最终的表面外观是许多 **具有不同表面取向的点的聚合结果** 。

对于大多数表面而言，微观几何表面法线分布是连续且各项同性的，并且在宏观表面法线较强处呈现较强峰值。这种分布“紧密度”由表面 **粗糙度(roughness)** 决定。表面越粗糙，则微观几何法线就会更加“扩散”。也就是说，在微观尺度上，表面越粗糙，反射越模糊，因为表面取向与整个宏观表面取向的偏离更强。也就是说，微表面法线影响宏观表面的反射率。

## 4.菲涅尔效应

**菲涅尔效应(fresnel effect)** 指的是反射随着 **掠射角(glancing angle, 入射光与表面的夹角)** 的增大而增强。如下图，三张图的书都垂直于表面放置，唯一不同的是拍摄的角度(掠射角)。当垂直入射时，几乎看不到反射。当接近grazing angle(浅入射角，入射光与表面平行)时，反射十分强烈。

通过上述例子，我们可以得出，某种材质的反射光强度与入射角度有关。光打到表面上，会进行折射与反射。而 **菲涅尔方程(fresnel equations)** 描述了从表面反射出来的光的数量。给定折射率(IOR)和掠射角，菲涅尔方程给出该材质在两种介质下入射该表面的反射率。

由于菲涅尔方程的复杂性，在实时渲染中，一般使用 **Schlick近似公式：F(n, l) = F + (1 - F) * pow(1 - cosθ, 5)**。

**个人理解下的菲涅尔效应是输入当前表面材质的反射率，得到在一定角度反射下的反射率，反射率最终其实就是反射光的频率，也就是颜色属性。**

## 5.微平面理论

